config:
  target: "http://localhost:5000"
  phases:
    - duration: 30
      arrivalRate: 5
      name: "Quick test - 5 users/sec for 30 seconds"
  processor: "./test-scenarios.js"

scenarios:
  - name: "Complete User Flow"
    flow:
      - function: "generateDriverData"
      # Register Driver
      - post:
          url: "/api/auth/register"
          json:
            name: "{{ name }}"
            email: "{{ email }}"
            phone: "{{ phone }}"
            password: "{{ password }}"
            role: "DRIVER"
          capture:
            - json: "$.token"
              as: "driverToken"
            - json: "$.user.id"
              as: "driverId"
      
      # Driver posts a ride
      - post:
          url: "/api/rides"
          headers:
            Authorization: "Bearer {{ driverToken }}"
          json:
            startLat: 40.4406
            startLng: -79.9959
            startAddress: "Downtown Pittsburgh, PA"
            endLat: 40.4433
            endLng: -79.9436
            endAddress: "Oakland, Pittsburgh, PA"
            departureTime: "{{ departureTime }}"
            availableSeats: 3
            pricePerSeat: 5.00
            routeFlexibility: "FLEXIBLE"
          capture:
            - json: "$.ride.id"
              as: "rideId"
      
      # Register Rider
      - function: "generateRiderData"
      - post:
          url: "/api/auth/register"
          json:
            name: "{{ name }}"
            email: "{{ email }}"
            phone: "{{ phone }}"
            password: "{{ password }}"
            role: "RIDER"
          capture:
            - json: "$.token"
              as: "riderToken"
      
      # Rider browses rides
      - get:
          url: "/api/rides"
          headers:
            Authorization: "Bearer {{ riderToken }}"
      
      # Rider books the ride
      - post:
          url: "/api/bookings"
          headers:
            Authorization: "Bearer {{ riderToken }}"
          json:
            rideId: "{{ rideId }}"
            pickupLat: 40.4406
            pickupLng: -79.9959
            pickupAddress: "Downtown Pittsburgh, PA"
            dropoffLat: 40.4433
            dropoffLng: -79.9436
            dropoffAddress: "Oakland, Pittsburgh, PA"
            seatsBooked: 1
            agreedPrice: 5.00
          capture:
            - json: "$.booking.id"
              as: "bookingId"

